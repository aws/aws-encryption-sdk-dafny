<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" Condition="Exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props')" />
  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>
    <ProjectGuid>{168246A2-E0A7-4605-B3DD-48F15E2987EA}</ProjectGuid>
    <OutputType>Library</OutputType>
    <AppDesignerFolder>Properties</AppDesignerFolder>
    <RootNamespace>dotnet</RootNamespace>
    <AssemblyName>dotnet</AssemblyName>
    <TargetFrameworkVersion>v4.7.2</TargetFrameworkVersion>
    <FileAlignment>512</FileAlignment>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
    <PlatformTarget>AnyCPU</PlatformTarget>
    <DebugSymbols>true</DebugSymbols>
    <DebugType>full</DebugType>
    <Optimize>false</Optimize>
    <OutputPath>bin\Debug\</OutputPath>
    <DefineConstants>DEBUG;TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
    <PlatformTarget>AnyCPU</PlatformTarget>
    <DebugType>pdbonly</DebugType>
    <Optimize>true</Optimize>
    <OutputPath>bin\Release\</OutputPath>
    <DefineConstants>TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
  </PropertyGroup>
  <PropertyGroup>
    <CoreCompileDependsOn>GenerateFromDafnySource;$(CoreCompileDependsOn)</CoreCompileDependsOn>
  </PropertyGroup>
  <ItemGroup>
    <Reference Include="BouncyCastle.Crypto, Version=1.8.5.0, Culture=neutral, PublicKeyToken=0e99375e54769942">
      <HintPath>..\lib\BouncyCastle.1.8.5\lib\BouncyCastle.Crypto.dll</HintPath>
      <Private>True</Private>
    </Reference>
    <Reference Include="System" />
    <Reference Include="System.Numerics" />
  </ItemGroup>
  <ItemGroup>
    <Compile Include="extern/dotnet/AESEncryption.cs" />
    <Compile Include="extern/dotnet/Arrays-extern.cs" />
    <Compile Include="extern/dotnet/HKDF-extern.cs" />
    <Compile Include="extern/dotnet/Random.cs" />
    <Compile Include="extern/dotnet/RSAEncryption.cs" />
    <Compile Include="extern/dotnet/Signature.cs" />
    <Compile Include="extern/dotnet/UTF8.cs" />
  </ItemGroup>
  <!--
    TODO: Temporary subset of files to build and verify.
    Add to this as more files can be verified.
    Eventually this can be a wildcard pattern.
  -->
  <ItemGroup>
    <DafnySource Include="Crypto/AESEncryption.dfy" />
    <DafnySource Include="Crypto/EncryptionSuites.dfy" />
    <DafnySource Include="Crypto/Digests.dfy" />
    <DafnySource Include="Crypto/HKDF/CryptoMac.dfy" />
    <DafnySource Include="Crypto/HKDF/HKDF.dfy" />
    <DafnySource Include="Crypto/HKDF/HKDFSpec.dfy" />
    <DafnySource Include="Crypto/Random.dfy" />
    <DafnySource Include="Crypto/RSAEncryption.dfy" />
    <DafnySource Include="Crypto/Signature.dfy" />
    <DafnySource Include="Main.dfy" />
    <DafnySource Include="SDK/AlgorithmSuite.dfy" />
    <DafnySource Include="SDK/Client.dfy" />
    <DafnySource Include="SDK/CMM/DefaultCMM.dfy" />
    <DafnySource Include="SDK/CMM/Defs.dfy" />
    <DafnySource Include="SDK/Deserialize.dfy" />
    <DafnySource Include="SDK/Keyring/RawAESKeyring.dfy" />
    <DafnySource Include="SDK/Keyring/Defs.dfy" />
    <DafnySource Include="SDK/Keyring/MultiKeyring.dfy" />
    <DafnySource Include="SDK/Keyring/RawRSAKeyring.dfy" />
    <DafnySource Include="SDK/Materials.dfy" />
    <DafnySource Include="SDK/MessageBody.dfy" />
    <DafnySource Include="SDK/MessageHeader.dfy" />
    <DafnySource Include="SDK/Serialize.dfy" />
    <DafnySource Include="SDK/ToyClient.dfy" />
    <DafnySource Include="StandardLibrary/Base64.dfy" />
    <DafnySource Include="StandardLibrary/StandardLibrary.dfy" />
    <DafnySource Include="StandardLibrary/UInt.dfy" />
    <DafnySource Include="Util/Arrays.dfy" />
    <DafnySource Include="Util/Streams.dfy" />
    <DafnySource Include="Util/UTF8.dfy" />
  </ItemGroup>
  <ItemGroup>
    <None Include="packages.config" />
  </ItemGroup>
  <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />
  <Target Name="Verify">
    <Exec Command="dafny %(DafnySource.Identity) /compile:0 &amp;&amp; mkdir -p build/%(DafnySource.Identity) &amp;&amp; touch build/%(DafnySource.Identity).verified" />
  </Target>
  <Target Name="BeforeBuild" DependsOnTargets="GenerateFromDafnySource" />
  <Target Name="GenerateFromDafnySource" DependsOnTargets="_GenerateFromDafnySource">
    <ItemGroup>
      <Compile Include="generated-src/Main.cs" />
    </ItemGroup>
  </Target>
  <Target Name="_GenerateFromDafnySource" DependsOnTargets="ResolveReferences" Inputs="$(MSBuildProjectFile);@(DafnySource)" Outputs="generated-src/Main.cs">
    <ItemGroup>
      <DafnyReferencePath Include="@(ReferencePath)" Condition="%(FileName) != 'mscorlib' And %(FileName) != 'System' And %(FileName) != 'System.Core' And %(FileName) != 'System.Numerics'" />
    </ItemGroup>
    <Exec Command="dafny /out:generated-src/Main @(DafnySource, ' ') @(Compile, ' ') @(DafnyReferencePath, ' ') /compile:2 /spillTargetCode:2 /noVerify /noIncludes" />
  </Target>
</Project>